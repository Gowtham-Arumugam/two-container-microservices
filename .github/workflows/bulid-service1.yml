name: Test and Build Service 1
on:
  workflow_dispatch:
  pull_request:
    types:
      - opened
    branches:
      - main
    # paths:
    #   - service1/**
  #need to remove this if you want to run on every push    
  # push:
  #   branches:
  #     - main
permissions:
  pull-requests: write
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Comment and close PR using REST API
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
          NUMBER: ${{ github.event.number }}
          MESSAGE: "This PR is being closed by automation."
        run: |
          curl -H "Authorization: Bearer $GITHUB_TOKEN" \
              -H "Accept: application/vnd.github+json" \
              -X POST \
              -d "{\"body\": \"$MESSAGE\"}" \
              "https://api.github.com/repos/$REPO/issues/$NUMBER/comments"
          curl -H "Authorization: Bearer $GITHUB_TOKEN" \
              -H "Accept: application/vnd.github+json" \
              -X PATCH \
              -d "{\"state\": \"closed\"}" \
              "https://api.github.com/repos/$REPO/pulls/$NUMBER"

            # - name: Checkout Code
            #   uses: actions/checkout@v4
            # - name: set up JDK 21
            #   uses: actions/setup-java@v4
            #   with:
            #     java-version: '21'
            #     distribution: 'temurin'
            # - name: Maven Build
            #   run: mvn -f ./service1/pom.xml clean package
            # - name: Maven Test
            #   run: mvn -f ./service1/pom.xml test
            # - uses: actions/github-script@v7
            #   with:
            #     script: |
            #       await github.rest.pulls.update({
            #         owner: context.repo.owner,
            #         repo: context.repo.repo,
            #         pull_number: context.payload.pull_request.number,
            #         state: 'closed'
            #       });
            